{% extends 'backend/base.html' %}

{% block content %}
  <h1>Create Product</h1>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div class="form-group">
      <label for="title">Title:</label>
      <input type="text" class="form-control" id="title" name="title" required>
    </div>
    
    <div class="form-group">
      <label for="description">Description:</label>
      <textarea class="form-control" id="description" name="description" required></textarea>
    </div>
    
    <div class="form-group">
      <label for="active">Active:</label>
      <input type="checkbox" class="form-check-input" id="active" name="active">
    </div>
    
    <div id="variant_fields">
      <div v-for="(variant, index) in variants" :key="index" class="variant-field">
        <input type="text" v-model="variant.variant_title" placeholder="Variant Title" name="variants[]" required>
        <input type="text" v-model="variant.variant_price" placeholder="Variant Price" name="variants[]" required>
        <input type="text" v-model="variant.variant_stock" placeholder="Variant Stock" name="variants[]" required>
        <button type="button" @click="removeVariant(index)">Remove</button>
      </div>
    </div>
    
    <button type="button" id="add_variant">Add Variant</button>
    
    <input type="file" name="image">
    
    <button type="submit">Create Product</button>
  </form>
{% endblock %}

{% block scripts %}
  <script>
    var createProductUrl = "{% url 'product:create_product' %}";

    var app = new Vue({
      el: '#variant_fields',
      data: {
        variants: []
      },
      methods: {
        addVariant() {
          this.variants.push({
            variant_title: '',
            variant_price: '',
            variant_stock: ''
          });
        },
        removeVariant(index) {
          this.variants.splice(index, 1);
        },
        createProduct() {
          const form = document.querySelector('form');
          const formData = new FormData(form);

          formData.append('variants', JSON.stringify(this.variants));
          formData.append('image', document.querySelector('input[type="file"]').files[0]);

          axios.post(createProductUrl, formData)
            .then(response => {
              console.log(response.data);
            })
            .catch(error => {
              console.log(error);
            });
        }
      }
    });

    document.getElementById('add_variant').addEventListener('click', function(event) {
      event.preventDefault();
      app.addVariant();
    });

    document.querySelector('form').addEventListener('submit', function(event) {
      event.preventDefault();
      app.createProduct();
    });
  </script>
{% endblock %}